---
# Build iBGP full mesh peer list

- name: Initialize iBGP peers list
  set_fact:
    frr_ibgp_peers: []

- name: Build iBGP full mesh peers
  set_fact:
    frr_ibgp_peers: "{{ frr_ibgp_peers + [peer_info] }}"
  vars:
    peer_info:
      name: "{{ item }}"
      loopback: "{{ hostvars[item].loopback }}"
  loop: "{{ ibgp_mesh | default([]) }}"
  when:
    - ibgp_mesh is defined
    - item != inventory_hostname
    - ibgp_enabled | default(false)

- name: Debug iBGP peers
  debug:
    var: frr_ibgp_peers
  when: frr_ibgp_peers is defined and (frr_ibgp_peers | length > 0)
